<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <!-- 队列表格行 -->
    <th:block th:fragment="queue-row">
        <tr th:id="${'queue-' + item.id}">
            <th:block th:replace="~{:: queue-row-content(${item})}"/>
        </tr>
    </th:block>

    <th:block th:fragment="queue-row-content(item)">
        <td>
            <span th:text="${item.recipient}">recipient@example.com</span>
        </td>
        <td>
            <span class="badge" th:classappend="${item.statusClass}" th:text="${item.statusText}">状态</span>
        </td>
        <td>
            <span th:text="${item.retryCount + '/' + item.maxRetries}">0/3</span>
        </td>
        <td>
            <span th:if="${item.nextRetryAt}" th:text="${#temporals.format(item.nextRetryAt, 'MM-dd HH:mm')}">-</span>
            <span th:unless="${item.nextRetryAt}" class="text-muted">-</span>
        </td>
        <td>
            <span th:if="${item.lastError}" class="error-text" th:text="${#strings.abbreviate(item.lastError, 50)}">错误信息</span>
            <span th:unless="${item.lastError}" class="text-muted">-</span>
        </td>
        <td>
            <span th:text="${#temporals.format(item.createdAt, 'MM-dd HH:mm')}">00:00</span>
        </td>
        <td>
            <div class="action-buttons">
                <button th:if="${item.status == 'failed'}" 
                        class="btn btn-icon btn-ghost"
                        title="重试"
                        th:hx-post="@{/queue/{id}/retry(id=${item.id})}"
                        th:hx-target="${'#queue-' + item.id}"
                        hx-swap="outerHTML">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 4 23 10 17 10"/>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                    </svg>
                </button>
                <button th:if="${item.status == 'pending'}" 
                        class="btn btn-icon btn-ghost btn-danger"
                        title="取消"
                        th:hx-post="@{/queue/{id}/cancel(id=${item.id})}"
                        th:hx-target="${'#queue-' + item.id}"
                        hx-swap="outerHTML"
                        hx-confirm="确定要取消这封邮件的发送吗？">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="15" y1="9" x2="9" y2="15"/>
                        <line x1="9" y1="9" x2="15" y2="15"/>
                    </svg>
                </button>
                <button class="btn btn-icon btn-ghost btn-danger"
                        title="删除"
                        th:hx-delete="@{/queue/{id}(id=${item.id})}"
                        th:hx-target="${'#queue-' + item.id}"
                        hx-swap="outerHTML"
                        hx-confirm="确定要删除这条记录吗？">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"/>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    </svg>
                </button>
            </div>
        </td>
    </th:block>
</body>
</html>

